{"version":3,"file":"public/scripts/app.js","sources":["app/initialize.coffee","app/lib/helpers.coffee","app/models/home.coffee","app/models/song.coffee","app/routers/main.coffee","app/views/home.coffee","app/views/song.coffee","app/views/templates/home.hbs","app/views/templates/song.hbs"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;;A,CCAA;;AACA;AADA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnBA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvDA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlEA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhGA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzFA;;A","sourcesContent":["require('lib/helpers');\n\nrequire('routers/main');\n\nwindow.iOS = Boolean(navigator.userAgent.match(/(iPad|iPhone|iPod)/g));\n\n$(function() {\n  return Backbone.history.start({\n    pushState: true\n  });\n});\n","Swag.Config.partialsPath = '../views/templates/';\n","var HomeModel, _ref,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nmodule.exports = HomeModel = (function(_super) {\n  __extends(HomeModel, _super);\n\n  function HomeModel() {\n    _ref = HomeModel.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  return HomeModel;\n\n})(Backbone.Model);\n","var Song, _ref,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nmodule.exports = Song = (function(_super) {\n  __extends(Song, _super);\n\n  function Song() {\n    _ref = Song.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  Song.prototype.url = function() {\n    return \"/api/songInfo/\" + (this.get('id'));\n  };\n\n  return Song;\n\n})(Backbone.Model);\n","var HomeView, MainRouter, Song, SongView, activateView, main, _ref,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nHomeView = require(\"../views/home\");\n\nSong = require(\"../models/song\");\n\nSongView = require(\"../views/song\");\n\nactivateView = function(ViewCls) {\n  var homeView;\n  homeView = new ViewCls().render();\n  return $(\"section.app\").empty().append(homeView.el);\n};\n\nMainRouter = (function(_super) {\n  __extends(MainRouter, _super);\n\n  function MainRouter() {\n    _ref = MainRouter.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  MainRouter.prototype.routes = {\n    'song/:sid': \"song\",\n    '': \"home\"\n  };\n\n  MainRouter.prototype.home = function() {\n    return activateView(HomeView);\n  };\n\n  MainRouter.prototype.song = function(sid) {\n    var song, songView;\n    song = new Song({\n      id: sid\n    });\n    songView = new SongView({\n      model: song\n    }).render();\n    return $(\"section.app\").empty().append(songView.el);\n  };\n\n  MainRouter.prototype.createCounter = function() {\n    return $(\"section.app\").empty().append('<p>create</p>');\n  };\n\n  return MainRouter;\n\n})(Backbone.Router);\n\nmain = new MainRouter();\n\nmodule.exports = main;\n","var HomeModel, HomeView, _ref,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nHomeModel = require('../models/home');\n\nmodule.exports = HomeView = (function(_super) {\n  __extends(HomeView, _super);\n\n  function HomeView() {\n    _ref = HomeView.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  HomeView.prototype.model = new HomeModel();\n\n  HomeView.prototype.template = require('views/templates/home');\n\n  HomeView.prototype.initialize = function() {\n    return this.disabled = false;\n  };\n\n  HomeView.prototype.render = function() {\n    var _this = this;\n    this.$el.html(this.template());\n    setTimeout(function() {\n      return _this.$(\"input\").focus();\n    }, 500);\n    return this;\n  };\n\n  HomeView.prototype.events = {\n    \"click .btn-primary\": \"requestLink\",\n    \"submit form\": \"requestLink\"\n  };\n\n  HomeView.prototype.requestLink = function(e) {\n    var originalLink,\n      _this = this;\n    e.preventDefault();\n    originalLink = this.$el.find(\"input\").val();\n    if (originalLink.length === 0) {\n      return;\n    }\n    if (this.disabled) {\n      return;\n    }\n    this.disabled = true;\n    return $.get(\"/api/findSong\", {\n      originalLink: originalLink\n    }).done(function(res) {\n      return window.location.href = \"/song/\" + res;\n    }).fail(function(res) {\n      _this.$(\".search-fail\").slideDown();\n      _this.disabled = false;\n      _this.$(\".btn-primary\").attr(\"disabled\", \"disabled\");\n      return _this.$(\"input\").on(\"keydown\", function() {\n        _this.$(\".search-fail\").slideUp();\n        return _this.$(\".btn-primary\").removeAttr(\"disabled\");\n      });\n    });\n  };\n\n  return HomeView;\n\n})(Backbone.View);\n","var SongView, _ref,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nmodule.exports = SongView = (function(_super) {\n  __extends(SongView, _super);\n\n  function SongView() {\n    _ref = SongView.__super__.constructor.apply(this, arguments);\n    return _ref;\n  }\n\n  SongView.prototype.template = require('views/templates/song');\n\n  SongView.prototype.initialize = function() {\n    this.listenTo(this.model, \"sync\", this.render, this);\n    return this.model.fetch();\n  };\n\n  SongView.prototype.events = {\n    \"click .rdio-open\": \"rememberRdio\",\n    \"click .spotify-open\": \"rememberSpotify\",\n    \"click .forget-preference\": \"forgetPreference\"\n  };\n\n  SongView.prototype.render = function() {\n    var ctx, pref,\n      _this = this;\n    pref = typeof localStorage !== \"undefined\" && localStorage !== null ? localStorage.SONGLINK_SERVICE_PREFERENCE : void 0;\n    ctx = _(this.model.attributes).clone();\n    if (ctx.rdio_track != null) {\n      if (window.iOS) {\n        ctx.rdio_link = ctx.rdio_track.shortUrl.replace(\"http:\\/\\/\", \"rdio:\\/\\/\");\n      } else {\n        ctx.rdio_link = \"http://rdio.com\" + ctx.rdio_track.url;\n      }\n    }\n    ctx.redirecting = false;\n    if (this.model.get(\"rdio_track\") && pref === \"rdio\") {\n      ctx.redirecting = true;\n      ctx.redirect_preference = \"Rdio\";\n    }\n    if (this.model.get(\"spotify_track\") && pref === \"spotify\") {\n      ctx.redirecting = true;\n      ctx.redirect_preference = \"Spotify\";\n    }\n    if (ctx.rdio_track) {\n      ctx.album_img = ctx.rdio_track.icon400 || ctx.rdio_track.icon;\n    }\n    this.$el.html(this.template(ctx));\n    if (ctx.redirecting) {\n      setTimeout(function() {\n        return _this.$(\".redirect-notify\").slideDown();\n      }, 1000);\n      setTimeout(function() {\n        return _this.doRedirect(ctx);\n      }, 4000);\n    }\n    return this;\n  };\n\n  SongView.prototype.doRedirect = function(ctx) {\n    var pref;\n    if (localStorage.SONGLINK_SERVICE_PREFERENCE == null) {\n      return;\n    }\n    pref = localStorage.SONGLINK_SERVICE_PREFERENCE;\n    if (pref === \"rdio\") {\n      window.location.href = ctx.rdio_link;\n      return;\n    }\n    if (pref === \"spotify\") {\n      window.location.href = ctx.spotify_track.href;\n      this.$(\".redirect-notify h3\").text(\"Redirect Complete.\");\n    }\n  };\n\n  SongView.prototype.rememberRdio = function() {\n    localStorage.SONGLINK_SERVICE_PREFERENCE = \"rdio\";\n    return true;\n  };\n\n  SongView.prototype.rememberSpotify = function() {\n    localStorage.SONGLINK_SERVICE_PREFERENCE = \"spotify\";\n    return true;\n  };\n\n  SongView.prototype.forgetPreference = function(e) {\n    delete localStorage.SONGLINK_SERVICE_PREFERENCE;\n    this.$(\".redirect-notify\").slideUp();\n    return e.preventDefault();\n  };\n\n  return SongView;\n\n})(Backbone.View);\n","module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  \n\n\n  return \"<!-- .home -->\\n<div class='row-fluid band pinkband'>\\n    <div class='row-fluid'>\\n        <h4>Enter a URL for a Song:</h4>\\n        <div class='row-fluid'>\\n            <form class='song-url-form'>\\n                <div class='search-fail'>\\n                    Did not understand that link. Songlink supports Rdio and Spotify links.\\n                </div>\\n                <input type=\\\"text\\\"></input>\\n            </form>\\n            <div class='btn btn-primary btn-large' style='margin-top: 30px'>Create Link</div>\\n        </div>\\n    </div>\\n</div>\\n\";\n  });","module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, functionType=\"function\", escapeExpression=this.escapeExpression, self=this;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1;\n  buffer += \"\\n            <div class='row-fluid redirect-notify' style='margin-bottom: 30px; text-align: center; display: none;'>\\n                <div class='span12'>\\n                    <h3>Redirecting to \";\n  if (stack1 = helpers.redirect_preference) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.redirect_preference; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"...</h3>\\n                    <h4>(<a href='#' class='forget-preference'>Forget Preference</a>)</h4>\\n                </div>\\n            </div>\\n        \";\n  return buffer;\n  }\n\nfunction program3(depth0,data) {\n  \n  var buffer = \"\", stack1;\n  buffer += \"\\n                <div class='span4'>\\n                    <img src=\\\"\";\n  if (stack1 = helpers.album_img) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.album_img; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" style=''></img>\\n                </div>\\n            \";\n  return buffer;\n  }\n\nfunction program5(depth0,data) {\n  \n  var buffer = \"\", stack1;\n  buffer += \"\\n                            <h3>\";\n  if (stack1 = helpers.title) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.title; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"</h3>\\n                        \";\n  return buffer;\n  }\n\nfunction program7(depth0,data) {\n  \n  var buffer = \"\", stack1;\n  buffer += \"\\n                            <h4>by \";\n  if (stack1 = helpers.artist_name) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.artist_name; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"</h4>\\n                        \";\n  return buffer;\n  }\n\nfunction program9(depth0,data) {\n  \n  var buffer = \"\", stack1;\n  buffer += \"\\n                            <a href=\\\"\";\n  if (stack1 = helpers.rdio_link) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.rdio_link; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" class='btn btn-lg btn-info rdio-open' style='margin-bottom: 20px;'>Open in Rdio</a>\\n                        \";\n  return buffer;\n  }\n\nfunction program11(depth0,data) {\n  \n  var buffer = \"\", stack1;\n  buffer += \"\\n                            <a href=\\\"\"\n    + escapeExpression(((stack1 = ((stack1 = depth0.spotify_track),stack1 == null || stack1 === false ? stack1 : stack1.href)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))\n    + \"\\\" class='btn btn-lg btn-success spotify-open' style='margin-bottom: 20px'>Open in Spotify</a>\\n                        \";\n  return buffer;\n  }\n\n  buffer += \"<!-- .song -->\\n<div class='row-fluid band pinkband'>\\n    <div class='row-fluid'>\\n        \";\n  stack1 = helpers['if'].call(depth0, depth0.redirecting, {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n        <div class='row-fluid'>\\n            \";\n  stack1 = helpers['if'].call(depth0, depth0.rdio_track, {hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n            <div class='span8'>\\n                <div class='row-fluid'>\\n                    <div class='row-fluid'>\\n                        \";\n  stack1 = helpers['if'].call(depth0, depth0.title, {hash:{},inverse:self.noop,fn:self.program(5, program5, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                        \";\n  stack1 = helpers['if'].call(depth0, depth0.artist_name, {hash:{},inverse:self.noop,fn:self.program(7, program7, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                    </div>\\n                    <div class='row-fluid'>\\n                        \";\n  stack1 = helpers['if'].call(depth0, depth0.rdio_track, {hash:{},inverse:self.noop,fn:self.program(9, program9, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                        \";\n  stack1 = helpers['if'].call(depth0, depth0.spotify_track, {hash:{},inverse:self.noop,fn:self.program(11, program11, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                    </div>\\n                </div>\\n            </div>\\n        </div>\\n    </div>\\n</div>\\n\";\n  return buffer;\n  });"]}